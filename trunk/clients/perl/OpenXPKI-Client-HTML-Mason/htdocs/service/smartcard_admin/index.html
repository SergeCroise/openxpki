<!--

TITLE: Smartcard Admin Interface

PURPOSE: Provide access to some useful utilities needed for managing smartcards

DETAILS: See Workflow-UI-for-smartcard-admin.graffle for details

-->

<%args>
</%args>
<%once>
use Data::Dumper;
use OpenXPKI::Serialization::Simple;
</%once>
<%init>

############################################################
# INIT - GLOBAL VARS
############################################################
our @errors;
our $debug_msg;
our $wf_type = 'I18N_OPENXPKI_WF_TYPE_SMARTCARD_CARDADM';

############################################################
# INIT - SUBROUTINES
############################################################

############################################################
# INIT - MAIN BLOCK
############################################################

my ($token_id, $token_owner); #$wf_id, $token_owner, $next_action);	# params passed via GET/POST
#my ($curr_user);	# param from Mason
#my ($wf, $c_msg, $wf_state);
#my ($need_token_id, $req_new_auth);	# state info for displaying page


# Novosec sends the ID with uppercase letters, but the XML file/workflow
# has it in lowercase. Also, the arg name 'TokenID' is hard-coded by them.

$token_id		= lc($m->request_args()->{TokenID});
#$wf_id			= $m->request_args()->{WF_ID};
$token_owner	= $m->request_args()->{TOKEN_OWNER};

warn
	"===== INIT BLOCK OF samartcard_admin/index.mhtml =====\n",
	"\trequest args = ", join(', ', %{ $m->request_args() }), "\n",
	"\ttoken_id = '$token_id'\n",
	"\ttoken_owner = '$token_owner'\n",
	"==========================================\n";

############################################################
# END OF INIT BLOCK
# 
# In the following section below, the page is actually presented.
############################################################
</%init>

<h1>Smartcard Administration</h1>

<p>Please enter either Smartcard Owner <em>or</em> Smartcard ID (serial number)</p>

<& /service/open_form.mhtml, action => 'fetch.html' &>
<table><tr><td>Smartcard Owner</td><td>
<& /lib/html/input.mhtml,
    name => 'TOKEN_OWNER',
    value => $token_owner,
    width => 25,
&></td></tr>
</table>
<& /service/send_form.mhtml &>
<& /service/close_form.mhtml &>

<br>

<& /service/open_form.mhtml, action => 'fetch.html' &>
<table><tr><td>Smartcard ID</td><td>
<& /lib/html/input.mhtml,
    name => 'TokenID',
    value => $token_id,
    width => 25,
&></td></tr>
</table>
<& /service/send_form.mhtml &>
<& /service/close_form.mhtml &>


